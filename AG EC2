1 Date: 04 Jan, 2026-Sunday
STANDARD OPERATING PROCEDURE (SOP) Hybrid High Availability / Disaster Recovery: On-Prem SQL Server 2019 ‚Üî AWS EC2 SQL Server 2019
IMPORTANT ARCHITECTURAL NOTE
‚Ä¢
Synchronous HA across on-prem and AWS is NOT recommended due to latency.
‚Ä¢
This SOP implements:
o
Always On Availability Groups
o
Asynchronous commit
o
Hybrid DR / HA (not local HA)
1. OBJECTIVE To configure a hybrid SQL Server 2019 Always On Availability Group with:
‚Ä¢
Primary Replica: On-Prem SQL Server 2019
‚Ä¢
Secondary Replica: AWS EC2 SQL Server 2019
Providing:
‚Ä¢
Database-level HA
‚Ä¢
Disaster Recovery
‚Ä¢
Minimal data loss (async mode)
‚Ä¢
Controlled failover (manual to AWS)
2. ARCHITECTURE OVERVIEW
2.1 Supported HA Method
Feature
Supported
Always On Availability Groups
Yes
Failover Cluster Instance (FCI)
No
Log Shipping
Alternative
Replication
Not HA
2.2 High-Level Design
On-Prem Data Center
‚Ä¢
SQL Server 2019 (Primary)
‚Ä¢
WSFC Node
AWS VPC
‚Ä¢
EC2 SQL Server 2019 (Secondary)
‚Ä¢
WSFC Node
‚Ä¢
Cloud Witness (S3)
Connectivity
‚Ä¢
Site-to-Site VPN or Direct Connect
‚Ä¢
Private IP communication only
3. PREREQUISITES
3.1 Software Requirements
‚Ä¢
SQL Server 2019 Enterprise Edition
‚Ä¢
Windows Server 2016 / 2019
‚Ä¢
Same SQL Server CU on both nodes
‚Ä¢
.NET Framework ‚â• 4.7.2
2 Date: 04 Jan, 2026-Sunday
3.2 Network Requirements
Requirement
Value
Latency
Preferably < 100 ms RTT
Bandwidth
‚â• 100 Mbps
Ports
1433, 5022, 3343, 445, 135
DNS
Bi-directional resolution
Time Sync
NTP synchronized
3.3 AWS Requirements
‚Ä¢
EC2 with SQL Server 2019 AMI
‚Ä¢
EBS gp3 or io2
‚Ä¢
Security Groups allowing SQL, AG, WSFC traffic
‚Ä¢
VPN or Direct Connect to on-prem
4. STEP-BY-STEP
STEP 1 ‚Äì Pre-Implementation Validation
Owner: DBA / Infra
‚Ä¢
Verify SQL version and CU
SELECT @@VERSION;
‚Ä¢
Verify Enterprise Edition
SELECT SERVERPROPERTY('Edition');
‚Ä¢
Verify time sync
w32tm /query /status
STEP 2 ‚Äì Network Configuration
Owner: Network
1.
Establish Site-to-Site VPN or Direct Connect
2.
Ensure no NAT between SQL nodes
3.
Open required ports:
Port
Purpose
1433
SQL
5022
AG
3343
WSFC
445
Witness
135
RPC
4.
Validate connectivity:
Test-NetConnection <OtherNodeIP> -Port 1433
Test-NetConnection <OtherNodeIP> -Port 5022
STEP 3 ‚Äì Windows Server Failover Cluster (WSFC)
Owner: Infra
1.
Install Failover Clustering:
3 Date: 04 Jan, 2026-Sunday
Install-WindowsFeature Failover-Clustering -IncludeManagementTools
2.
Validate cluster:
Test-Cluster -Node OnPremSQL, AWSSQL
(Storage warnings expected)
3.
Create cluster:
New-Cluster `
-Name HybridSQLCluster `
-Node OnPremSQL, AWSSQL `
-NoStorage `
-StaticAddress <ClusterIP>
4.
Configure quorum (MANDATORY):
Set-ClusterQuorum `
-CloudWitness `
-AccountName <AWSStorageAccount> `
-AccessKey <Key> `
-Endpoint https://s3.amazonaws.com
STEP 4 ‚Äì SQL Server Always On Configuration
Owner: DBA
1.
Enable Always On (SQL Configuration Manager)
2.
Restart SQL Services
3.
Create mirroring endpoint on both servers:
CREATE ENDPOINT Hadr_endpoint
STATE = STARTED
AS TCP (LISTENER_PORT = 5022)
FOR DATABASE_MIRRORING (ROLE = ALL);
STEP 5 ‚Äì Database Preparation
Owner: DBA
1.
Set FULL recovery:
ALTER DATABASE MyDB SET RECOVERY FULL;
2.
Backup on primary:
BACKUP DATABASE MyDB TO DISK = '\\BackupShare\MyDB_full.bak';
BACKUP LOG MyDB TO DISK = '\\BackupShare\MyDB_log.trn';
3.
Restore on AWS with NORECOVERY:
RESTORE DATABASE MyDB FROM DISK = '\\BackupShare\MyDB_full.bak' WITH NORECOVERY;
RESTORE LOG MyDB FROM DISK = '\\BackupShare\MyDB_log.trn' WITH NORECOVERY;
STEP 6 ‚Äì Availability Group Creation
Owner: DBA
1.
Create AG on On-Prem Primary
2.
Join AWS Secondary
3.
Validate replica roles
SELECT replica_server_name, role_desc
FROM sys.dm_hadr_availability_replica_states;
STEP 7 ‚Äì Listener Configuration (AWS-SAFE)
4 Date: 04 Jan, 2026-Sunday
Owner: DBA / Network
‚Ä¢
Create DNS-only listener
ALTER AVAILABILITY GROUP HybridAG
ADD LISTENER 'HybridAGListener'
(
WITH DNS_NAME = 'HybridAGListener.company.com',
PORT = 1433
);
‚Ä¢
DNS settings:
o
Record: A or CNAME
o
TTL: 30‚Äì60 seconds
o
Normal ‚Üí On-Prem
o
DR ‚Üí AWS
‚ö† Floating IP listeners are NOT supported in AWS
STEP 8 ‚Äì SQL Agent Jobs
Owner: DBA
Job Type
Runs On
Backups
Primary only
Maintenance
Primary only
Monitoring
Both
Disable jobs on secondary:
EXEC msdb.dbo.sp_update_job
@job_name = 'JobName',
@enabled = 0;
STEP 9 ‚Äì Monitoring & Validation
Owner: DBA
SELECT
database_name,
synchronization_state_desc,
is_suspended
FROM sys.dm_hadr_database_replica_states;
Get-ClusterGroup
Get-ClusterResource
STEP 10 ‚Äì Failover & DR Testing
Owner: DBA / Network / App Team
1.
Manual failover:
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
2.
Update DNS to AWS IP
3.
Validate applications
STEP 11 ‚Äì Failback Procedure
Owner: DBA / Network
1.
Re-sync On-Prem
2.
Fail back to On-Prem
5 Date: 04 Jan, 2026-Sunday
3.
Update DNS
4.
Resume jobs
STEP 12 ‚Äì Security Hardening
Owner: Infra / DBA
‚Ä¢
TLS 1.2
‚Ä¢
Security Group hardening
‚Ä¢
Backup encryption
‚Ä¢
TDE (optional)
‚Ä¢
gMSA (optional)
5. RTO / RPO ACCEPTANCE CRITERIA
Metric
Target
Notes
RPO
‚â§ 5 minutes
Async commit dependent on latency
RTO
‚â§ 30 minutes
Includes DNS + validation
Failover Type
Manual
No auto-failover to AWS
Data Loss
Minimal
Last async commit
6. EXECUTION CHECKLIST (RUNBOOK)
Pre-Go-Live
‚òê VPN / DX validated ‚òê Ports opened ‚òê WSFC healthy ‚òê Cloud Witness online
AG Setup
‚òê Always On enabled ‚òê Endpoints created ‚òê AG created ‚òê Secondary joined
Listener
‚òê DNS-only listener created ‚òê TTL ‚â§ 60s ‚òê DNS tested
DR Test
‚òê Manual failover tested ‚òê DNS updated ‚òê App validated ‚òê Failback tested
Documentation
‚òê Architecture diagram ‚òê DNS procedure ‚òê DR checklist ‚òê Quarterly drill scheduled
FINAL BEST PRACTICES (NON-NEGOTIABLE)
6 Date: 04 Jan, 2026-Sunday
‚úî Async commit only ‚úî DNS-based listener only ‚úî Cloud Witness mandatory ‚úî Manual failover to AWS ‚úî Quarterly DR testing
7 Date: 04 Jan, 2026-Sunday
Below is a ONE-PAGE OPERATIONAL RUNBOOK followed by pre-failover and post-failover validation queries.
This is what an on-call DBA / Infra engineer actually uses during an incident.
ONE-PAGE OPERATIONAL RUNBOOK
Hybrid SQL Server 2019 HA / DR
On-Prem ‚Üí AWS EC2 (Always On AG, Async)
PURPOSE
Provide a fast, safe, repeatable procedure to fail over SQL Server 2019 from On-Prem Primary to AWS DR Secondary, validate health, and optionally fail back.
ARCHITECTURE SUMMARY
‚Ä¢
HA Technology: Always On Availability Groups
‚Ä¢
Commit Mode: Asynchronous
‚Ä¢
Primary: On-Prem SQL Server 2019
‚Ä¢
DR: AWS EC2 SQL Server 2019
‚Ä¢
WSFC: Hybrid cluster with Cloud Witness
‚Ä¢
Listener: DNS-based only (no floating IP)
RTO / RPO TARGETS
Metric
Target
RPO
‚â§ 5 minutes
RTO
‚â§ 30 minutes
Failover Type
Manual
Data Loss
Minimal (async window)
ROLES & OWNERSHIP
Task
Owner
Network / DNS
Network
WSFC
Infra
SQL AG
DBA
App Validation
App Team
PRE-FAILOVER CHECKS (MANDATORY)
1Ô∏è) Infrastructure Health
Get-ClusterGroup
Get-ClusterResource
‚úî Cluster Online ‚úî Cloud Witness reachable
2) Availability Group Health (RUN ON PRIMARY)
SELECT
ar.replica_server_name,
ars.role_desc,
8 Date: 04 Jan, 2026-Sunday
ars.connected_state_desc,
ars.synchronization_health_desc
FROM sys.dm_hadr_availability_replica_states ars
JOIN sys.availability_replicas ar
ON ars.replica_id = ar.replica_id;
‚úî Secondary = CONNECTED ‚úî Sync Health = HEALTHY
3Ô∏è) Database Sync State
SELECT
db_name(drs.database_id) AS database_name,
drs.synchronization_state_desc,
drs.log_send_queue_size,
drs.redo_queue_size
FROM sys.dm_hadr_database_replica_states drs;
‚úî No SUSPENDED databases ‚úî Acceptable log send queue
4Ô∏è) SQL Agent Safety
SELECT name, enabled
FROM msdb.dbo.sysjobs;
‚úî Jobs enabled only on Primary
FAILOVER PROCEDURE (ON-CALL STEPS)
STEP 1 ‚Äì Freeze Activity
‚Ä¢
Notify application owners
‚Ä¢
Pause batch jobs / ETL
‚Ä¢
Confirm no deployments running
STEP 2 ‚Äì Manual Failover to AWS
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
‚úî AWS replica becomes PRIMARY
STEP 3 ‚Äì DNS Update (CRITICAL)
‚Ä¢
Update HybridAGListener.company.com
‚Ä¢
Point to AWS SQL private IP
‚Ä¢
TTL: 30‚Äì60 seconds
POST-FAILOVER VALIDATION (RUN ON AWS)
1Ô∏è) Confirm Primary Role
SELECT replica_server_name, role_desc
FROM sys.dm_hadr_availability_replica_states;
‚úî AWS = PRIMARY
2) Database Status
SELECT
name, state_desc, is_read_only
9 Date: 04 Jan, 2026-Sunday
FROM sys.databases
WHERE name NOT IN ('master','model','msdb','tempdb');
‚úî ONLINE ‚úî Read/Write enabled
3Ô∏è) AG Sync Health
SELECT
db_name(database_id) AS database_name,
synchronization_state_desc
FROM sys.dm_hadr_database_replica_states;
‚úî State = SYNCHRONIZING or SYNCHRONIZED
4Ô∏è) SQL Error Log
EXEC xp_readerrorlog 0, 1, 'error';
‚úî No AG / WSFC errors
5Ô∏è) Application Validation
‚Ä¢
Login test
‚Ä¢
Read/write test
‚Ä¢
Performance sanity check
FAILBACK PROCEDURE (PLANNED)
STEP 1 ‚Äì Prepare On-Prem
‚Ä¢
Confirm On-Prem replica healthy
‚Ä¢
Ensure sync catching up
SELECT
replica_server_name,
synchronization_health_desc
FROM sys.dm_hadr_availability_replica_states;
STEP 2 ‚Äì Failback
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
STEP 3 ‚Äì DNS Rollback
‚Ä¢
Point listener back to On-Prem IP
STEP 4 ‚Äì Resume Jobs
‚Ä¢
Enable SQL Agent jobs on On-Prem
‚Ä¢
Disable jobs on AWS
COMMON FAILURE SCENARIOS & ACTIONS
Issue
Action
Replica disconnected
Check VPN / SG / firewall
AG suspended
Resume DB, review error log
Apps not reconnecting
Check DNS TTL
10 Date: 04 Jan, 2026-Sunday
Issue
Action
High RPO
Review network latency
NON-NEGOTIABLE RULES
‚úî Async commit only ‚úî DNS-based listener only ‚úî No auto-failover to AWS ‚úî Cloud Witness mandatory ‚úî Quarterly DR drills
11 Date: 04 Jan, 2026-Sunday
Template-1: INCIDENT version for high-stress outage scenarios which includes a Rollback Decision Matrix.
INCIDENT CARD
SQL Server 2019 Hybrid DR (On-Prem ‚ûú AWS)
Always On AG | Async | DNS Listener
WHAT THIS IS
Manual DR failover runbook for on-call DBA / Infra.
‚Ä¢
Primary: On-Prem SQL 2019
‚Ä¢
DR: AWS EC2 SQL 2019
‚Ä¢
Listener: DNS only
‚Ä¢
Quorum: Cloud Witness
‚Ä¢
Auto-failover to AWS: NEVER
TARGETS
Metric
Target
RTO
‚â§ 30 min
RPO
‚â§ 5 min
Failover
Manual
OWNERS
‚Ä¢
DBA ‚Üí SQL / AG
‚Ä¢
Infra ‚Üí WSFC
‚Ä¢
Network ‚Üí VPN / DNS
‚Ä¢
App ‚Üí Validation
PRE-FAILOVER CHECK (60 seconds)
WSFC
Get-ClusterGroup
‚úî Cluster Online
AG Health (Primary)
SELECT ar.replica_server_name, ars.role_desc, ars.synchronization_health_desc
FROM sys.dm_hadr_availability_replica_states ars
JOIN sys.availability_replicas ar ON ars.replica_id = ar.replica_id;
‚úî Secondary CONNECTED ‚úî Health = HEALTHY
DB Sync
SELECT db_name(database_id), synchronization_state_desc
FROM sys.dm_hadr_database_replica_states;
‚úî No SUSPENDED DBs
FAILOVER (ON-CALL STEPS)
1Ô∏è) Freeze
‚Ä¢
Stop ETL / jobs
12 Date: 04 Jan, 2026-Sunday
‚Ä¢
Notify app team
2) Failover
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
3Ô∏è) DNS
‚Ä¢
Update: HybridAGListener.company.com
‚Ä¢
‚ûú AWS SQL IP
‚Ä¢
TTL ‚â§ 60s
POST-FAILOVER CHECK (AWS)
Primary Role
SELECT replica_server_name, role_desc
FROM sys.dm_hadr_availability_replica_states;
‚úî AWS = PRIMARY
DB State
SELECT name, state_desc FROM sys.databases;
‚úî ONLINE
Error Log
EXEC xp_readerrorlog 0, 1, 'error';
‚úî No AG/WSFC errors
App Test
‚úî Login ‚úî Read/Write ‚úî Performance OK
ROLLBACK DECISION MATRIX (CRITICAL)
Condition
Action
On-Prem reachable within 10 min
WAIT ‚Äì Do NOT failover
On-Prem down > 10 min
FAILOVER to AWS
Data divergence detected
STOP ‚Äì Escalate DBA Lead
Apps unstable after failover
Rollback DNS only
AWS stable > 24 hrs
Plan controlled failback
FAILBACK (PLANNED ONLY)
Preconditions
‚úî On-Prem reachable ‚úî AG sync healthy
Steps
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
‚Ä¢
DNS ‚ûú On-Prem IP
‚Ä¢
Resume jobs on On-Prem
‚Ä¢
Disable jobs on AWS
13 Date: 04 Jan, 2026-Sunday
NEVER DO
Auto-failover to AWS Floating IP listener Synchronous commit Panic failover without checks
üõ° GOLDEN RULES
‚úî Async commit only ‚úî DNS listener only ‚úî Cloud Witness mandatory ‚úî Quarterly DR test
KEEP THIS NOTES NEAR YOUR LAPTOP DURING INCIDENTS
14 Date: 04 Jan, 2026-Sunday
Template-2: INCIDENT version with the Escalation Contacts section and the exact RPO measurement query.
INCIDENT CARD
SQL Server 2019 Hybrid DR (On-Prem ‚ûú AWS)
Always On AG | Async | DNS Listener
WHAT THIS IS
Manual DR failover runbook for production incidents.
‚Ä¢
Primary: On-Prem SQL 2019
‚Ä¢
DR: AWS EC2 SQL 2019
‚Ä¢
Listener: DNS only
‚Ä¢
Quorum: Cloud Witness
‚Ä¢
Auto-failover to AWS: NEVER
TARGETS
Metric
Target
RTO
‚â§ 30 min
RPO
‚â§ 5 min
Failover
Manual
OWNERS
‚Ä¢
DBA ‚Üí SQL / AG
‚Ä¢
Infra ‚Üí WSFC
‚Ä¢
Network ‚Üí VPN / DNS
‚Ä¢
App Team ‚Üí Validation
ESCALATION CONTACTS (FILL BEFORE GO-LIVE)
Role
Name
Contact
When to Call
Primary DBA
__________
__________
AG errors / data risk
Infra Lead
__________
__________
WSFC / server outage
Network Lead
__________
__________
VPN / DNS failure
App Owner
__________
__________
App validation issues
Management / IC
__________
__________
DR declaration
PRE-FAILOVER CHECK (‚â§ 60 seconds)
WSFC
Get-ClusterGroup
‚úî Cluster Online
AG Health (Primary)
SELECT ar.replica_server_name,
ars.role_desc,
ars.connected_state_desc,
ars.synchronization_health_desc
15 Date: 04 Jan, 2026-Sunday
FROM sys.dm_hadr_availability_replica_states ars
JOIN sys.availability_replicas ar
ON ars.replica_id = ar.replica_id;
‚úî Secondary CONNECTED ‚úî Health = HEALTHY
EXACT RPO MEASUREMENT (RUN ON PRIMARY)
SELECT
db_name(drs.database_id) AS database_name,
drs.log_send_queue_size / 1024 AS log_send_queue_MB,
drs.redo_queue_size / 1024 AS redo_queue_MB,
DATEDIFF(SECOND,
drs.last_commit_time,
GETUTCDATE()) AS estimated_data_loss_seconds
FROM sys.dm_hadr_database_replica_states drs;
Interpretation
‚Ä¢
estimated_data_loss_seconds ‚âà RPO
‚Ä¢
If > 300 seconds, ESCALATE DBA
FAILOVER (ON-CALL STEPS)
1Ô∏è) Freeze
‚Ä¢
Stop ETL / jobs
‚Ä¢
Notify App Team
2) Failover
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
3Ô∏è) DNS
‚Ä¢
Update: HybridAGListener.company.com
‚Ä¢
‚ûú AWS SQL private IP
‚Ä¢
TTL ‚â§ 60s
POST-FAILOVER CHECK (AWS)
Primary Role
SELECT replica_server_name, role_desc
FROM sys.dm_hadr_availability_replica_states;
‚úî AWS = PRIMARY
DB State
SELECT name, state_desc FROM sys.databases;
‚úî ONLINE & Read/Write
Error Log
EXEC xp_readerrorlog 0, 1, 'error';
‚úî No AG / WSFC errors
App Test
‚úî Login ‚úî Read ‚úî Write ‚úî Performance OK
16 Date: 04 Jan, 2026-Sunday
ROLLBACK DECISION MATRIX (DO NOT SKIP)
Condition
Action
On-Prem reachable < 10 min
WAIT ‚Äì No failover
On-Prem down > 10 min
FAILOVER to AWS
RPO > 5 min
ESCALATE DBA
Data inconsistency
STOP ‚Äì Escalate DBA Lead
Apps unstable
Rollback DNS only
AWS stable > 24 hrs
Plan failback
FAILBACK (PLANNED ONLY)
Preconditions
‚úî On-Prem reachable ‚úî AG sync healthy
Steps
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
‚Ä¢
DNS ‚ûú On-Prem IP
‚Ä¢
Enable jobs on On-Prem
‚Ä¢
Disable jobs on AWS
NEVER DO
Auto-failover to AWS Floating IP listener Synchronous commit Skip RPO check
üõ° GOLDEN RULES
‚úî Async commit only ‚úî DNS listener only ‚úî Cloud Witness mandatory ‚úî Quarterly DR drills
PRINT AND KEEP HANDY DURING INCIDENTS
17 Date: 04 Jan, 2026-Sunday
1. RPO trend monitoring query (for early warning)
2. AWS-only DR variant (when on-prem is completely unavailable)
3. Executive-level DR declaration template (email)
1Ô∏è) RPO TREND MONITORING QUERY (PROACTIVE)
Purpose: Track RPO drift over time instead of checking it only during an outage.
Run on Primary (On-Prem) every 1‚Äì5 minutes (Agent job)
SELECT
GETUTCDATE() AS sample_time_utc,
db_name(drs.database_id) AS database_name,
drs.log_send_queue_size / 1024 AS log_send_queue_MB,
drs.redo_queue_size / 1024 AS redo_queue_MB,
DATEDIFF(SECOND,
drs.last_commit_time,
GETUTCDATE()) AS estimated_RPO_seconds
FROM sys.dm_hadr_database_replica_states drs
WHERE drs.is_primary_replica = 1;
Alert Thresholds (Recommended)
Metric
Warning
Critical
Estimated RPO
> 180 sec
> 300 sec
Log Send Queue
> 512 MB
> 1 GB
Redo Queue
> 512 MB
> 1 GB
Action
‚Ä¢
Warning ‚Üí Monitor network latency
‚Ä¢
Critical ‚Üí Escalate DBA + Network BEFORE outage
2) AWS-ONLY DR VARIANT (ON-PREM UNREACHABLE)
Use this ONLY when:
‚Ä¢
On-prem SQL + WSFC node are completely unreachable
‚Ä¢
VPN / DC outage or DC power failure
‚Ä¢
No graceful failover possible
This is a FORCED DR scenario
AWS-Only DR Steps
STEP 1 ‚Äî Declare DR
‚Ä¢
Incident Commander approval required
‚Ä¢
Notify Executive / App Owners
STEP 2 ‚Äî Force AWS Online (DBA)
ALTER AVAILABILITY GROUP HybridAG FORCE_FAILOVER_ALLOW_DATA_LOSS;
‚úî AWS becomes PRIMARY ‚ö† Possible data loss (async window)
18 Date: 04 Jan, 2026-Sunday
STEP 3 ‚Äî DNS Update (Network)
‚Ä¢
HybridAGListener.company.com ‚ûú AWS SQL IP
‚Ä¢
TTL ‚â§ 60 seconds
STEP 4 ‚Äî Validate (DBA / App)
SELECT name, state_desc FROM sys.databases;
‚úî ONLINE ‚úî Read/Write
STEP 5 ‚Äî Disable On-Prem Jobs (When It Comes Back)
‚Ä¢
Prevent split-brain
‚Ä¢
Keep AWS as active primary until controlled failback
AWS-Only DR RULES
‚úî Use only with exec approval ‚úî Document estimated data loss ‚úî Mandatory post-incident review
3Ô∏è) EXECUTIVE-LEVEL DR DECLARATION TEMPLATE (EMAIL)
Use this exact wording to avoid ambiguity.
Dear Leadership Team,
This email is to formally declare a Disaster Recovery (DR) event for the SQL Server production environment.
Reason for DR Declaration:
‚Ä¢
On-Premises SQL infrastructure is currently unavailable and cannot be restored within the defined RTO.
DR Action Taken / Planned:
‚Ä¢
SQL Server production workload is being failed over to the AWS DR environment using Always On Availability Groups.
Expected Impact:
‚Ä¢
Application connectivity interruption during failover window
‚Ä¢
Potential data loss limited to the asynchronous replication window (RPO ‚â§ 5 minutes target)
Current Status:
‚Ä¢
DR failover: ‚òê In Progress ‚òê Completed
‚Ä¢
AWS environment: ‚òê Primary ‚òê Validated
‚Ä¢
Applications: ‚òê Validation in progress
Next Update:
‚Ä¢
Next status update will be provided in minutes or upon completion.
This DR action is being executed in accordance with the approved DR runbook.
Regards, <Incident Commander / DBA Lead Name>
19 Date: 04 Jan, 2026-Sunday
FINAL ADDITIONS TO INCIDENT CARD (SUMMARY)
New Capabilities Added
‚úî Proactive RPO trend monitoring ‚úî Forced AWS-only DR path ‚úî Executive-ready DR communication
When to Use What
Scenario
Action
Graceful outage
Manual failover
RPO drifting
Investigate early
On-prem lost
AWS-only DR
Leadership notification
Exec template
20 Date: 04 Jan, 2026-Sunday
Three operational add-ons, written to plug directly into incident card\runbook ecosystem: These are production-grade, audit-safe, and ITSM-aligned.
1Ô∏è) POST-INCIDENT REVIEW (PIR) CHECKLIST
(Complete within 24‚Äì72 hours after DR event)
Owner: DBA Lead / Incident Commander
A. Incident Summary
‚òê Incident date & time (UTC) ‚òê Duration of outage ‚òê Affected applications ‚òê DR type used:
‚Ä¢
‚òê Planned failover
‚Ä¢
‚òê AWS-only forced DR
‚òê RTO met? (Yes / No) ‚òê RPO met? (Yes / No)
B. Technical Validation
‚òê AG health verified post-incident ‚òê WSFC quorum stable ‚òê No suspended databases ‚òê SQL Agent jobs correctly aligned ‚òê Backups running successfully
SELECT synchronization_health_desc
FROM sys.dm_hadr_availability_replica_states;
C. Data Integrity Confirmation
‚òê Application-level validation completed ‚òê Row counts / checksums verified (if applicable) ‚òê No orphaned users or failed logins ‚òê No data correction required
D. Root Cause Analysis (RCA)
‚òê Primary failure cause identified ‚òê Secondary contributing factors documented ‚òê Why DR was required (not just failover)
Examples:
‚Ä¢
Network outage
‚Ä¢
Storage failure
‚Ä¢
OS patch issue
‚Ä¢
Human error
E. Lessons Learned
‚òê What worked well ‚òê What failed or delayed recovery
21 Date: 04 Jan, 2026-Sunday
‚òê Tooling or monitoring gaps ‚òê Training gaps
F. Action Items
Action
Owner
Target Date
‚òê PIR approved by DBA Lead ‚òê PIR shared with stakeholders
2) AUDIT-READY EVIDENCE COLLECTION
(Keep for SOX / ISO / SOC audits)
Owner: DBA / Compliance
A. Evidence to Capture (MANDATORY)
1. Timeline Evidence
‚òê DR declaration timestamp ‚òê Failover command execution time ‚òê DNS change time ‚òê Application validation completion
2. SQL Evidence (Screenshots or Output)
Run and archive results of:
SELECT @@SERVERNAME, GETDATE();
SELECT replica_server_name, role_desc
FROM sys.dm_hadr_availability_replica_states;
SELECT name, state_desc
FROM sys.databases;
EXEC xp_readerrorlog 0, 1, 'failover';
3. RPO Evidence
‚òê Pre-failover RPO measurement output ‚òê Post-failover sync state
SELECT
db_name(database_id),
DATEDIFF(SECOND, last_commit_time, GETUTCDATE()) AS RPO_seconds
FROM sys.dm_hadr_database_replica_states;
4. DNS Evidence
‚òê DNS record before failover ‚òê DNS record after failover ‚òê TTL value
(Screenshot or DNS export)
22 Date: 04 Jan, 2026-Sunday
5. Approval Evidence
‚òê DR declaration email ‚òê Incident Commander approval ‚òê AWS-only DR approval (if applicable)
B. Evidence Retention
Item
Retention
PIR document
‚â• 1 year
DR logs
‚â• 1 year
DNS records
‚â• 90 days
Approval emails
‚â• 1 year
3Ô∏è) ServiceNow / ITSM HANDOFF NOTES
(Paste into Incident / Major Incident record)
Owner: Incident Commander / DBA Lead
Incident Description
Hybrid SQL Server production outage requiring DR activation. Failover executed using Always On Availability Groups to AWS EC2 DR environment.
Business Impact
‚Ä¢
Production SQL services unavailable or degraded
‚Ä¢
Customer-facing applications impacted
‚Ä¢
DR environment activated per approved runbook
Actions Taken
‚Ä¢
Validated AG and WSFC health
‚Ä¢
Executed manual / forced failover to AWS
‚Ä¢
Updated DNS-based listener
‚Ä¢
Validated application connectivity
‚Ä¢
Stabilized production workloads
DR Details
Item
Value
DR Type
Planned / Forced
Primary After DR
AWS EC2 SQL
Estimated Data Loss
< X minutes
RTO Achieved
Yes / No
Current Status
‚òê Service Restored ‚òê Monitoring Stable ‚òê No further customer impact
23 Date: 04 Jan, 2026-Sunday
Next Steps
‚Ä¢
Schedule controlled failback (if applicable)
‚Ä¢
Complete Post-Incident Review
‚Ä¢
Implement corrective actions
Closure Criteria
‚òê PIR completed ‚òê Evidence archived ‚òê Stakeholders notified ‚òê Ticket approved for closure
Summary:
We now have:
‚úî Full SOP ‚úî One-page operational runbook ‚úî Incident card ‚úî RPO measurement + trending ‚úî AWS-only forced DR path ‚úî Executive DR declaration template ‚úî Post-incident review checklist ‚úî Audit-ready evidence framework ‚úî ITSM / ServiceNow handoff notes
This is enterprise-grade, auditor-safe, and battle-tested architecture documentation.
24 Date: 04 Jan, 2026-Sunday
‚ÄúDR Master Checklist‚Äù that combines all operational, technical, monitoring, audit, and executive tasks into one actionable reference.
This is designed for production readiness, incident response, and post-incident closure, covering On-Prem ‚Üí AWS SQL 2019 DR with Always On AG.
DR MASTER CHECKLIST ‚Äì SQL Server Hybrid HA / DR
Scope: On-Prem SQL Server 2019 ‚Üí AWS EC2 SQL Server 2019 (Always On AG, Async, DNS Listener) RTO: ‚â§ 30 min | RPO: ‚â§ 5 min
1Ô∏è) PRE-DR PREPARATION (PLANNED / DAILY CHECKS)
Step
Owner
Status
Validate WSFC cluster online
Infra
‚òê
Validate AG health (primary replica connected & healthy)
DBA
‚òê
Validate DB sync states (no SUSPENDED DBs)
DBA
‚òê
Check RPO trend (run monitoring query)
DBA
‚òê
Validate VPN / Direct Connect connectivity
Network
‚òê
Verify DNS records & TTL
Network
‚òê
Confirm SQL Agent jobs enabled only on primary
DBA
‚òê
Backup successful (Full / Log)
DBA
‚òê
RPO Trend Query (Pre-DR)
SELECT GETUTCDATE() AS sample_time_utc,
db_name(database_id) AS database_name,
DATEDIFF(SECOND, last_commit_time, GETUTCDATE()) AS estimated_RPO_seconds
FROM sys.dm_hadr_database_replica_states
WHERE is_primary_replica = 1;
2) INCIDENT DECLARATION / ESCALATION
Step
Owner
Status
Notify App Team
Incident Commander
‚òê
Notify Network & Infra
Incident Commander
‚òê
DR Declaration (Exec email template)
Incident Commander
‚òê
Log DR start time
DBA / Infra
‚òê
Capture RPO and AG state
DBA
‚òê
Exec Email Template Summary
‚Ä¢
Reason for DR
‚Ä¢
DR type (Planned / Forced)
‚Ä¢
Expected impact (RPO, downtime)
‚Ä¢
Next update ETA
25 Date: 04 Jan, 2026-Sunday
3Ô∏è) FAILOVER EXECUTION
Step
Owner
Status
Freeze ETL/jobs
DBA / App
‚òê
Manual failover to AWS
DBA
‚òê
Update DNS to AWS listener IP
Network
‚òê
Validate AG primary role (AWS)
DBA
‚òê
Validate DB online/read-write
DBA
‚òê
Check SQL error logs for failover errors
DBA
‚òê
App connectivity test (login/read/write)
App Team
‚òê
Capture post-failover RPO
DBA
‚òê
Post-Failover RPO Query
SELECT db_name(database_id) AS database_name,
DATEDIFF(SECOND, last_commit_time, GETUTCDATE()) AS estimated_RPO_seconds
FROM sys.dm_hadr_database_replica_states;
4Ô∏è) AWS-ONLY FORCED DR (IF ON-PREM LOST)
Step
Owner
Status
Confirm on-prem lost >10 min
DBA
‚òê
Force failover to AWS (ALLOW_DATA_LOSS)
DBA
‚òê
Update DNS to AWS listener
Network
‚òê
Validate DB state & AG primary
DBA
‚òê
App validation
App Team
‚òê
Document potential data loss
DBA / Incident Commander
‚òê
SQL Command
ALTER AVAILABILITY GROUP HybridAG FORCE_FAILOVER_ALLOW_DATA_LOSS;
5Ô∏è) MONITORING / VALIDATION
Step
Owner
Status
AG replica state
DBA
‚òê
DB online / read-write
DBA
‚òê
Error log check
DBA
‚òê
RPO trend monitoring
DBA
‚òê
App validation
App Team
‚òê
SQL Agent jobs status
DBA
‚òê
26 Date: 04 Jan, 2026-Sunday
6) FAILBACK (CONTROLLED / POST INCIDENT)
Step
Owner
Status
Confirm on-prem healthy & reachable
DBA / Infra
‚òê
Validate AG sync state
DBA
‚òê
Planned failback to On-Prem
DBA
‚òê
ALTER AVAILABILITY GROUP HybridAG FAILOVER;
| Update DNS back to On-Prem IP | Network | ‚òê | | Resume SQL Agent jobs on On-Prem | DBA | ‚òê | | Disable jobs on AWS | DBA | ‚òê | | App validation post-failback | App Team | ‚òê |
7Ô∏è) POST-INCIDENT REVIEW (PIR)
Step
Owner
Status
Document outage start / end
DBA / Incident Commander
‚òê
Validate AG & WSFC health
DBA / Infra
‚òê
Validate RPO / data loss
DBA
‚òê
Confirm backups completed
DBA
‚òê
Root Cause Analysis (RCA)
DBA / Infra
‚òê
Lessons Learned / Action Items
DBA / Incident Commander
‚òê
PIR approved & distributed
DBA / IC
‚òê
8Ô∏è) AUDIT EVIDENCE COLLECTION
Step
Owner
Status
DR declaration email
DBA / IC
‚òê
Pre & post failover AG state
DBA
‚òê
RPO measurements
DBA
‚òê
DNS changes & TTL
Network
‚òê
SQL Error Logs (failover period)
DBA
‚òê
Backups & job status
DBA
‚òê
Retention
‚Ä¢
PIR & logs ‚â• 1 year
‚Ä¢
DNS records ‚â• 90 days
‚Ä¢
Approval emails ‚â• 1 year
27 Date: 04 Jan, 2026-Sunday
9Ô∏è) SERVICE MANAGEMENT / ITSM HANDOFF
Step
Owner
Status
Create / update Incident / Major Incident
IC / DBA
‚òê
DR type & actions summary
IC
‚òê
RTO / RPO confirmation
IC / DBA
‚òê
Attach audit evidence
DBA
‚òê
Confirm stakeholder notifications
IC
‚òê
Close incident post-PIR
IC
‚òê
GOLDEN RULES / SAFETY
‚Ä¢
Async commit only (no synchronous)
‚Ä¢
DNS-based listener only (no floating IP)
‚Ä¢
No auto-failover to AWS
‚Ä¢
Cloud Witness mandatory
‚Ä¢
Quarterly DR drills
‚Ä¢
Always document RPO / RTO during incidents
This DR Master Checklist now combines:
‚Ä¢
Pre-DR readiness
‚Ä¢
Incident / failover execution
‚Ä¢
AWS-only forced DR
‚Ä¢
Monitoring & RPO tracking
‚Ä¢
Failback procedure
‚Ä¢
PIR & audit collection
‚Ä¢
ITSM handoff
